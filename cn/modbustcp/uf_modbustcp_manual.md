# UF\_ModbusTcp\_Manual

{% hint style="danger" %}
~~**注意**~~
{% endhint %}

* 协议遵循标准ModbusTCP协议
* 所有数据按照⼤端格式传输, 如16位数据0x1234对应的2字节数据为0x12和0x34
* 不同地址的寄存器的值意义不⼀样, 请参⻅附录说明&#x20;
* 访问的地址要在定义的范围(请参⻅附录说明)内，否则会得到异常响应





## 各种寄存器所⽀持的ModbusTCP功能码

### 线圈状态寄存器(1位)

* 0x01: 读取多个寄存器的值，对应的ModbusTCP协议回复的数据的每⼀位表⽰1个寄存器的值

```
// ⽰例请求与响应/异常
// 请求: 从地址0x0000开始读取16个寄存器
00 01 00 00 00 06 01 01 00 00 00 10
// 响应: 读取到的 0xF7 0x00 的每⼀位对应1个寄存器的值(以实际获取到的为准)
00 01 00 00 00 05 01 01 02 F7 00
// 异常: XX为异常码
00 01 00 00 00 03 01 81 XX
```

* 0x05: 写单个寄存器的值, 对应ModbusTCP协议中的数据只能是0xFF00或0x0000，分别对应 的寄存器值1和0

```
// ⽰例请求与响应/异常
// 请求: 向地址为0x0002的寄存器写⼊1 (0xFF00 表⽰写⼊1, 0x0000 表⽰写⼊0)
00 01 00 00 00 06 01 05 00 02 FF 00
// 响应
00 01 00 00 00 06 01 05 00 02 FF 00
// 异常: XX为异常码
00 01 00 00 00 03 01 85 XX
```

* 0x0F: 写多个寄存器的值

```
// ⽰例请求与响应/异常
// 请求: 从地址0x0002开始写⼊3个寄存器的值, 0x07表⽰3个寄存器都写⼊1
00 01 00 00 00 08 01 0F 00 02 00 03 01 07
// 响应
00 01 00 00 00 06 01 0F 00 02 00 03
// 异常: XX为异常码
00 01 00 00 00 03 01 8F XX
```



### 离散输⼊状态寄存器(1位)

* 0x02: 读多个寄存器的值

```
// ⽰例请求与响应/异常
// 请求: 从地址0x0000开始读取16个寄存器
00 01 00 00 00 06 01 02 00 00 00 10
// 响应: 读取到的 0xFF 0x00 的每⼀位对应1个寄存器的值(以实际获取到的为准)
00 01 00 00 00 05 01 02 02 FF 00
// 异常: XX为异常码
00 01 00 00 00 03 01 82 XX
```



### 保持寄存器(16位)

* 0x03: 读多个寄存器的值

```
// ⽰例请求与响应/异常
// 请求: 从地址0x0003开始读取2个寄存器的值
00 01 00 00 00 06 01 03 00 03 00 02
// 响应: 读取到的2个寄存器的值分别为(00 05)和(00 06)，(以实际获取到的为准)
00 01 00 00 00 07 01 03 04 00 05 00 06
// 异常: XX为异常码
00 01 00 00 00 03 01 83 XX
```

* 0x06: 写单个寄存器的值

```
// ⽰例请求与响应/异常
// 请求: 向地址位0x0020的寄存器写⼊0x0006
00 01 00 00 00 06 01 06 00 20 00 06
// 响应
00 01 00 00 00 06 01 06 00 20 00 06
// 异常: XX为异常码
00 01 00 00 00 03 01 86 XX
```

* 0x10: 写多个寄存器的值

```
// ⽰例请求与响应/异常
// 请求: 从地址0x0003开始写⼊2个寄存器的值
// 写⼊两个寄存器的值分别为(04 D2)和(0D 80), 对应的10进制为1234和3456
00 01 00 00 00 0B 01 10 00 03 00 02 04 04 D2 0D 80
// 响应
00 01 00 00 00 06 01 10 00 03 00 02
// 异常: XX为异常码
00 01 00 00 00 03 01 90 XX
```

* 0x16: 以掩码的形式写单个寄存器的值

```
/// ⽰例请求与响应/异常
// 请求: 以掩码的形式写地址为0x0000的寄存器
// 与操作的掩码为(00 0F)，或操作的掩码为(0F 00)
// 假定操作前寄存器值为val, 掩码过后的值为 (val & 0x000F) | (0x0F00 & ~0x000F)
00 04 00 00 00 08 01 16 00 00 00 0F 0F 00
// 响应
00 04 00 00 00 08 01 16 00 00 00 0F 0F 00
// 异常: XX为异常码
00 01 00 00 00 03 01 96 XX
```

* 0x17: 写多个寄存器的值，并读多个寄存器的值

```
// ⽰例请求与响应/异常
// 请求: 从地址0x0020开始写⼊2个寄存器的值, 并从地址为0x0003开始读取2个寄存器的值
// 写⼊到2个寄存器的值分别为(00 06)和(00 04)
00 01 00 00 00 0F 01 17 00 03 00 02 00 20 00 02 04 00 06 00 04
// 响应: 读取到的2个寄存器的值分别为(04 D1)和(0D 7F)，(以实际获取到的为准)
00 01 00 00 00 07 01 17 04 04 D1 0D 7F
// 异常: XX为异常码
00 01 00 00 00 03 01 97 XX
```



### 输⼊寄存器(16位)

* 0x04: 读多个寄存器的值

```
// ⽰例请求与响应/异常
// 请求: 从地址0x0003开始获取2个寄存器的值
00 01 00 00 00 06 01 04 00 03 00 02
// 响应: 读取到的2个寄存器的值分别为(00 0E)和(00 13)，(以实际获取到的为准)
00 01 00 00 00 07 01 04 04 00 0E 00 13
// 异常: XX为异常码
00 01 00 00 00 03 01 84 XX
```





## 异常码说明

{% hint style="warning" %}
**0x01: 功能码不⽀持**
{% endhint %}

{% hint style="warning" %}
**0x02: 要访问的寄存器地址⾮法**
{% endhint %}

{% hint style="warning" %}
**0x03: 请求数据异常**
{% endhint %}































